openapi: 3.1.0
info:
  title: OwnaFarm API
  description: >-
    API OwnaFarm - Platform investasi pertanian berbasis blockchain.
    Autentikasi menggunakan EIP-712 Typed Data Signature dari wallet Ethereum.
  version: 1.0.0
servers:
  - url: https://ownafarm-backend-production.up.railway.app
    description: Production Server
tags:
  - name: Authentication
    description: Autentikasi user menggunakan wallet Ethereum (EIP-712)
  - name: Admin Authentication
    description: Autentikasi admin menggunakan wallet signature
  - name: Admin Farmer Management
    description: Manajemen farmer oleh admin
  - name: Admin Invoice Management
    description: Manajemen invoice oleh admin
  - name: Farmer Registration
    description: Registrasi petani dengan upload dokumen
  - name: Farmer Auth
    description: Autentikasi farmer menggunakan wallet signature (terpisah dari investor)
  - name: Farmer Farm Management
    description: Manajemen kebun oleh farmer (authenticated)
  - name: Farmer Invoice Management
    description: Manajemen invoice oleh farmer (authenticated)
  - name: Investor Crops
    description: API untuk manajemen investasi (crops) dari investor. Investasi disinkronisasi dari blockchain Mantle Network.
  - name: Investor Leaderboard
    description: API untuk leaderboard investor berdasarkan XP, kekayaan, atau profit.

paths:
  # ==================== USER AUTHENTICATION ====================
  /auth/nonce:
    get:
      summary: Get Nonce
      description: Mendapatkan nonce untuk proses signing EIP-712
      operationId: getNonce
      tags:
        - Authentication
      parameters:
        - name: wallet_address
          in: query
          required: true
          description: Alamat wallet Ethereum (format 0x...)
          schema:
            type: string
            pattern: ^0x[0-9a-fA-F]{40}$
            example: '0x742d35Cc6634C0532925a3b844BC9e7595f7CCCC'
      responses:
        '200':
          description: Nonce berhasil dibuat
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/NonceResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingWallet:
                  summary: Wallet address tidak ada
                  value:
                    status: error
                    message: wallet_address is required
                invalidFormat:
                  summary: Format wallet tidak valid
                  value:
                    status: error
                    message: Invalid wallet address format
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Failed to generate nonce

  /auth/login:
    post:
      summary: Login dengan Wallet Signature
      description: Verifikasi signature EIP-712 dan dapatkan JWT token
      operationId: loginWithSignature
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login berhasil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidBody:
                  summary: Request body tidak valid
                  value:
                    status: error
                    message: Invalid request body
                invalidFormat:
                  summary: Format wallet tidak valid
                  value:
                    status: error
                    message: Invalid wallet address format
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidNonce:
                  summary: Nonce tidak valid atau expired
                  value:
                    status: error
                    message: Invalid or expired nonce
                invalidSignature:
                  summary: Signature tidak cocok
                  value:
                    status: error
                    message: Invalid signature
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Failed to verify signature

  # ==================== ADMIN AUTHENTICATION ====================
  /admin/auth/nonce:
    get:
      summary: Get Admin Nonce
      description: >-
        Mendapatkan nonce untuk proses signing admin.
        Nonce hanya bisa dipakai sekali dan expired dalam 5 menit.
      operationId: getAdminNonce
      tags:
        - Admin Authentication
      parameters:
        - name: wallet_address
          in: query
          required: true
          description: Wallet address admin (format 0x...)
          schema:
            type: string
            pattern: ^0x[0-9a-fA-F]{40}$
            example: '0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb'
      responses:
        '200':
          description: Nonce berhasil dibuat
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminNonceResponse'
        '400':
          description: Invalid wallet
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invalid wallet address format
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Failed to generate nonce

  /admin/auth/login:
    post:
      summary: Admin Login
      description: >-
        Login admin dengan wallet signature.
        Rate limit: 5 attempts per 15 menit.
      operationId: adminLogin
      tags:
        - Admin Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminLoginRequest'
      responses:
        '200':
          description: Login berhasil
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminLoginResponse'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invalid request body
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseWithAttempts'
              examples:
                invalidSignature:
                  summary: Signature tidak valid
                  value:
                    status: error
                    message: Invalid signature
                    remaining_attempts: 4
                invalidNonce:
                  summary: Nonce tidak valid
                  value:
                    status: error
                    message: Invalid or expired nonce
                    remaining_attempts: 3
                adminNotFound:
                  summary: Admin tidak ditemukan
                  value:
                    status: error
                    message: Admin not found
                accountInactive:
                  summary: Akun tidak aktif
                  value:
                    status: error
                    message: Account is inactive
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RateLimitErrorResponse'
              example:
                status: error
                message: Too many login attempts
                retry_after_seconds: 900
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  # ==================== ADMIN FARMER MANAGEMENT ====================
  /admin/farmers:
    get:
      summary: Get Farmers List
      description: Mendapatkan list farmers dengan filtering, pagination, dan sorting
      operationId: getAdminFarmers
      tags:
        - Admin Farmer Management
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: query
          required: false
          description: >-
            Filter status farmer (bisa multiple).
            Values: pending, under_review, approved, rejected, suspended
          schema:
            type: array
            items:
              type: string
              enum:
                - pending
                - under_review
                - approved
                - rejected
                - suspended
          style: form
          explode: true
        - name: page
          in: query
          required: false
          description: Page number
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          required: false
          description: Items per page (max 100)
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
        - name: sort_by
          in: query
          required: false
          description: Field untuk sorting
          schema:
            type: string
            enum:
              - created_at
              - full_name
              - status
            default: created_at
        - name: sort_order
          in: query
          required: false
          description: Urutan sorting
          schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
        - name: search
          in: query
          required: false
          description: Search di name, email, phone
          schema:
            type: string
      responses:
        '200':
          description: List farmers berhasil diambil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/FarmersListResponse'
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invalid query parameters
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Failed to get farmers

  /admin/farmers/{id}:
    get:
      summary: Get Farmer Detail
      description: >-
        Mendapatkan detail farmer beserta dokumen (dengan presigned download URL).
      operationId: getAdminFarmerDetail
      tags:
        - Admin Farmer Management
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Farmer ID (UUID)
          schema:
            type: string
            format: uuid
            example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Farmer detail berhasil diambil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/FarmerDetailResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farmer ID is required
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farmer not found
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Failed to get farmer detail

  /admin/farmers/{id}/approve:
    patch:
      summary: Approve Farmer
      description: >-
        Approve farmer yang statusnya `pending`. Status akan berubah menjadi `approved`.
      operationId: approveFarmer
      tags:
        - Admin Farmer Management
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Farmer ID (UUID)
          schema:
            type: string
            format: uuid
            example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Farmer berhasil di-approve
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/FarmerApproveResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farmer ID is required
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farmer not found
        '409':
          description: Conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farmer has already been processed (not in pending status)
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  /admin/farmers/{id}/reject:
    patch:
      summary: Reject Farmer
      description: >-
        Reject farmer yang statusnya `pending`. Status akan berubah menjadi `rejected`.
        Status ini bersifat final dan tidak dapat diubah.
      operationId: rejectFarmer
      tags:
        - Admin Farmer Management
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Farmer ID (UUID)
          schema:
            type: string
            format: uuid
            example: 550e8400-e29b-41d4-a716-446655440000
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FarmerRejectRequest'
      responses:
        '200':
          description: Farmer berhasil di-reject
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/FarmerRejectResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farmer ID is required
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farmer not found
        '409':
          description: Conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farmer has already been processed (not in pending status)
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  # ==================== FARMER REGISTRATION ====================
  /farmers/documents/presign:
    post:
      summary: Get Presigned URLs
      description: >-
        Mendapatkan presigned URLs untuk upload dokumen langsung ke S3/Storage.
        File diupload langsung ke storage, tidak melalui backend.
      operationId: getPresignedUrls
      tags:
        - Farmer Registration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PresignRequest'
      responses:
        '200':
          description: Presigned URLs berhasil dibuat
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/PresignResponse'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invalid request body
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Failed to generate presigned URLs

  /farmers/register:
    post:
      summary: Register Farmer
      description: >-
        Mendaftarkan petani baru dengan data lengkap dan dokumen yang sudah diupload.
        Backend akan memverifikasi file sudah ada di storage sebelum menyimpan data farmer.
      operationId: registerFarmer
      tags:
        - Farmer Registration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FarmerRegistrationRequest'
      responses:
        '201':
          description: Farmer berhasil didaftarkan
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/FarmerRegistrationResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidBody:
                  summary: Request body tidak valid
                  value:
                    status: error
                    message: Invalid request body
                invalidDate:
                  summary: Format tanggal salah
                  value:
                    status: error
                    message: Invalid date format for date_of_birth, expected YYYY-MM-DD
        '409':
          description: Conflict - Data sudah ada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farmer with this email or phone number already exists
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Failed to register farmer

  # ==================== FARMER AUTH ====================
  /farmer/auth/nonce:
    get:
      summary: Get Farmer Nonce
      description: >-
        Mendapatkan nonce untuk proses signing farmer.
        Farmer menggunakan sistem autentikasi terpisah dari investor.
      operationId: getFarmerNonce
      tags:
        - Farmer Auth
      parameters:
        - name: wallet_address
          in: query
          required: true
          description: Wallet address farmer (format 0x...)
          schema:
            type: string
            pattern: ^0x[0-9a-fA-F]{40}$
            example: '0x742d35Cc6634C0532925a3b844BC9e7595f7CCCC'
      responses:
        '200':
          description: Nonce berhasil dibuat
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/FarmerNonceResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingWallet:
                  summary: Wallet address tidak ada
                  value:
                    status: error
                    message: wallet_address query parameter is required
                invalidFormat:
                  summary: Format wallet tidak valid
                  value:
                    status: error
                    message: Invalid wallet address format
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Failed to generate nonce

  /farmer/auth/login:
    post:
      summary: Farmer Login
      description: >-
        Login farmer dengan wallet signature.
        Hanya farmer dengan status `approved` yang dapat login.
      operationId: farmerLogin
      tags:
        - Farmer Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FarmerLoginRequest'
      responses:
        '200':
          description: Login berhasil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/FarmerLoginResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidBody:
                  summary: Request body tidak valid
                  value:
                    status: error
                    message: Invalid request body
                invalidFormat:
                  summary: Format wallet tidak valid
                  value:
                    status: error
                    message: Invalid wallet address format
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidNonce:
                  summary: Nonce tidak valid
                  value:
                    status: error
                    message: Invalid or expired nonce
                invalidSignature:
                  summary: Signature tidak valid
                  value:
                    status: error
                    message: Invalid signature
                notFound:
                  summary: Farmer tidak ditemukan
                  value:
                    status: error
                    message: Farmer account not found. Please register first.
        '403':
          description: Farmer not approved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FarmerNotApprovedResponse'
              example:
                status: error
                message: Farmer account is not approved
                data:
                  current_status: pending
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Failed to verify signature

  /farmer/me:
    get:
      summary: Get Current Farmer
      description: Mendapatkan data farmer yang sedang login.
      operationId: getCurrentFarmer
      tags:
        - Farmer Auth
      security:
        - FarmerBearerAuth: []
      responses:
        '200':
          description: Data farmer berhasil diambil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/FarmerProfile'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farmer not authenticated
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farmer not found

  # ==================== FARMER FARM MANAGEMENT ====================
  /farmer/farms:
    post:
      summary: Create Farm
      description: Membuat kebun baru untuk farmer yang sudah approved.
      operationId: createFarm
      tags:
        - Farmer Farm Management
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateFarmRequest'
      responses:
        '201':
          description: Farm berhasil dibuat
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      farm:
                        $ref: '#/components/schemas/Farm'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invalid request body
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '403':
          description: Farmer not approved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farmer profile is not approved
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

    get:
      summary: List My Farms
      description: Mendapatkan list kebun milik farmer yang sedang login.
      operationId: listMyFarms
      tags:
        - Farmer Farm Management
      security:
        - BearerAuth: []
      parameters:
        - name: is_active
          in: query
          required: false
          description: Filter berdasarkan status aktif
          schema:
            type: boolean
        - name: page
          in: query
          required: false
          description: Page number
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          required: false
          description: Items per page (max 100)
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
        - name: sort_by
          in: query
          required: false
          description: Field untuk sorting
          schema:
            type: string
            enum:
              - created_at
              - name
              - location
              - land_area
            default: created_at
        - name: sort_order
          in: query
          required: false
          description: Urutan sorting
          schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
        - name: search
          in: query
          required: false
          description: Search di name, location
          schema:
            type: string
      responses:
        '200':
          description: List farms berhasil diambil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/FarmsListResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  /farmer/farms/{id}:
    get:
      summary: Get Farm Detail
      description: Mendapatkan detail kebun berdasarkan ID.
      operationId: getFarmDetail
      tags:
        - Farmer Farm Management
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Farm ID (UUID)
          schema:
            type: string
            format: uuid
            example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
      responses:
        '200':
          description: Farm detail berhasil diambil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      farm:
                        $ref: '#/components/schemas/Farm'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '404':
          description: Farm not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farm not found
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

    put:
      summary: Update Farm
      description: Mengupdate data kebun.
      operationId: updateFarm
      tags:
        - Farmer Farm Management
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Farm ID (UUID)
          schema:
            type: string
            format: uuid
            example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateFarmRequest'
      responses:
        '200':
          description: Farm berhasil diupdate
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      farm:
                        $ref: '#/components/schemas/Farm'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invalid request body
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '404':
          description: Farm not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farm not found
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

    delete:
      summary: Delete Farm (Soft Delete)
      description: Menonaktifkan kebun (soft delete - set is_active = false).
      operationId: deleteFarm
      tags:
        - Farmer Farm Management
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Farm ID (UUID)
          schema:
            type: string
            format: uuid
            example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
      responses:
        '200':
          description: Farm berhasil di-delete
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Farm deleted successfully
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '404':
          description: Farm not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farm not found
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  # ==================== FARMER INVOICE MANAGEMENT ====================
  /farmer/invoices/image/presign:
    post:
      summary: Get Presigned URL for Invoice Image
      description: Mendapatkan presigned URL untuk upload gambar invoice/tanaman.
      operationId: getInvoiceImagePresignUrl
      tags:
        - Farmer Invoice Management
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InvoiceImagePresignRequest'
      responses:
        '200':
          description: Presigned URL berhasil dibuat
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/InvoiceImagePresignResponse'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invalid request body
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Failed to generate presigned URL

  /farmer/invoices:
    post:
      summary: Create Invoice
      description: Membuat invoice/pengajuan proyek pendanaan baru.
      operationId: createInvoice
      tags:
        - Farmer Invoice Management
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInvoiceRequest'
      responses:
        '201':
          description: Invoice berhasil dibuat
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      invoice:
                        $ref: '#/components/schemas/Invoice'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidBody:
                  summary: Request body tidak valid
                  value:
                    status: error
                    message: Invalid request body
                farmNotActive:
                  summary: Farm tidak aktif
                  value:
                    status: error
                    message: Farm is not active
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '404':
          description: Farm not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Farm not found
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

    get:
      summary: List My Invoices
      description: Mendapatkan list invoice milik farmer yang sedang login.
      operationId: listMyInvoices
      tags:
        - Farmer Invoice Management
      security:
        - BearerAuth: []
      parameters:
        - name: farm_id
          in: query
          required: false
          description: Filter berdasarkan farm ID
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          required: false
          description: Filter status invoice (bisa multiple)
          schema:
            type: array
            items:
              type: string
              enum:
                - pending
                - approved
                - rejected
          style: form
          explode: true
        - name: page
          in: query
          required: false
          description: Page number
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          required: false
          description: Items per page (max 100)
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
        - name: sort_by
          in: query
          required: false
          description: Field untuk sorting
          schema:
            type: string
            enum:
              - created_at
              - name
              - target_fund
              - status
            default: created_at
        - name: sort_order
          in: query
          required: false
          description: Urutan sorting
          schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
        - name: search
          in: query
          required: false
          description: Search di name
          schema:
            type: string
      responses:
        '200':
          description: List invoices berhasil diambil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/FarmerInvoicesListResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  /farmer/invoices/{id}:
    get:
      summary: Get Invoice Detail
      description: Mendapatkan detail invoice berdasarkan ID.
      operationId: getFarmerInvoiceDetail
      tags:
        - Farmer Invoice Management
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Invoice ID (UUID)
          schema:
            type: string
            format: uuid
            example: i1a2b3c4-d5e6-7890-abcd-ef1234567890
      responses:
        '200':
          description: Invoice detail berhasil diambil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      invoice:
                        $ref: '#/components/schemas/Invoice'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '404':
          description: Invoice not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invoice not found
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  # ==================== ADMIN INVOICE MANAGEMENT ====================
  /admin/invoices:
    get:
      summary: Get Invoices List (Admin)
      description: Mendapatkan list invoices dengan filtering, pagination, dan sorting.
      operationId: getAdminInvoices
      tags:
        - Admin Invoice Management
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: query
          required: false
          description: Filter status invoice (bisa multiple)
          schema:
            type: array
            items:
              type: string
              enum:
                - pending
                - approved
                - rejected
          style: form
          explode: true
        - name: page
          in: query
          required: false
          description: Page number
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          required: false
          description: Items per page (max 100)
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
        - name: sort_by
          in: query
          required: false
          description: Field untuk sorting
          schema:
            type: string
            enum:
              - created_at
              - name
              - target_fund
              - status
            default: created_at
        - name: sort_order
          in: query
          required: false
          description: Urutan sorting
          schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
        - name: search
          in: query
          required: false
          description: Search di name
          schema:
            type: string
      responses:
        '200':
          description: List invoices berhasil diambil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/AdminInvoicesListResponse'
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invalid query parameters
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  /admin/invoices/{id}:
    get:
      summary: Get Invoice Detail (Admin)
      description: Mendapatkan detail invoice berdasarkan ID.
      operationId: getAdminInvoiceDetail
      tags:
        - Admin Invoice Management
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Invoice ID (UUID)
          schema:
            type: string
            format: uuid
            example: i1a2b3c4-d5e6-7890-abcd-ef1234567890
      responses:
        '200':
          description: Invoice detail berhasil diambil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      invoice:
                        $ref: '#/components/schemas/AdminInvoiceDetail'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '404':
          description: Invoice not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invoice not found
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  /admin/invoices/{id}/approve:
    patch:
      summary: Approve Invoice
      description: >-
        Approve invoice yang statusnya pending. Status akan berubah menjadi approved
        dan invoice akan muncul di Shop untuk investor.
        
        **Penting:** Endpoint ini memerlukan data dari transaksi blockchain.
        Frontend harus memanggil smart contract `OwnaFarmNFT.approveInvoice(tokenId)`
        terlebih dahulu, lalu mengirimkan token_id dan tx_hash ke endpoint ini.
      operationId: approveInvoice
      tags:
        - Admin Invoice Management
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Invoice ID (UUID)
          schema:
            type: string
            format: uuid
            example: i1a2b3c4-d5e6-7890-abcd-ef1234567890
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InvoiceApproveRequest'
      responses:
        '200':
          description: Invoice berhasil di-approve
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/InvoiceApproveResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invalid request body. token_id and approval_tx_hash are required
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invoice not found
        '409':
          description: Conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invoice has already been processed (not in pending status)
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  /admin/invoices/{id}/reject:
    patch:
      summary: Reject Invoice
      description: >-
        Reject invoice yang statusnya pending. Status akan berubah menjadi rejected.
      operationId: rejectInvoice
      tags:
        - Admin Invoice Management
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Invoice ID (UUID)
          schema:
            type: string
            format: uuid
            example: i1a2b3c4-d5e6-7890-abcd-ef1234567890
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InvoiceRejectRequest'
      responses:
        '200':
          description: Invoice berhasil di-reject
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/InvoiceRejectResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invoice ID is required
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Unauthorized
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invoice not found
        '409':
          description: Conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invoice has already been processed (not in pending status)
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  # ==================== INVESTOR CROPS ====================
  /marketplace/invoices:
    get:
      summary: Browse Marketplace Invoices
      description: >-
        Mendapatkan list invoice (farm) yang tersedia untuk diinvest.
        Menampilkan invoice yang sudah approved oleh admin dan belum fully funded.
        Investor dapat melihat detail farm, farmer, dan progress funding.
      operationId: listMarketplaceInvoices
      tags:
        - Investor Crops
      security:
        - BearerAuth: []
      parameters:
        - name: min_price
          in: query
          required: false
          description: Minimum target fund (GOLD)
          schema:
            type: number
            format: float
            minimum: 0
            example: 1000.0
        - name: max_price
          in: query
          required: false
          description: Maximum target fund (GOLD)
          schema:
            type: number
            format: float
            minimum: 0
            example: 5000.0
        - name: min_yield
          in: query
          required: false
          description: Minimum yield percent (0-100)
          schema:
            type: number
            format: float
            minimum: 0
            maximum: 100
            example: 15.0
        - name: max_yield
          in: query
          required: false
          description: Maximum yield percent (0-100)
          schema:
            type: number
            format: float
            minimum: 0
            maximum: 100
            example: 25.0
        - name: min_duration
          in: query
          required: false
          description: Minimum duration in days
          schema:
            type: integer
            minimum: 1
            example: 30
        - name: max_duration
          in: query
          required: false
          description: Maximum duration in days
          schema:
            type: integer
            minimum: 1
            example: 120
        - name: min_land_area
          in: query
          required: false
          description: Minimum farm land area (hectare)
          schema:
            type: number
            format: float
            minimum: 0
            example: 1.5
        - name: max_land_area
          in: query
          required: false
          description: Maximum farm land area (hectare)
          schema:
            type: number
            format: float
            minimum: 0
            example: 5.0
        - name: location
          in: query
          required: false
          description: Search in farm location (case-insensitive)
          schema:
            type: string
            example: bogor
        - name: crop_type
          in: query
          required: false
          description: Search in invoice name for crop type (case-insensitive)
          schema:
            type: string
            example: padi
        - name: page
          in: query
          required: false
          description: Page number (default 1)
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: limit
          in: query
          required: false
          description: Items per page (default 10, max 100)
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
            example: 10
        - name: sort_by
          in: query
          required: false
          description: Sort field
          schema:
            type: string
            enum: [created_at, name, target_fund, yield_percent, duration_days]
            default: yield_percent
            example: yield_percent
        - name: sort_order
          in: query
          required: false
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
            example: desc
      responses:
        '200':
          description: List invoices berhasil diambil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/MarketplaceInvoicesListResponse'
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Invalid query parameters
                details: 'min_yield must be between 0 and 100'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: User not authenticated
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Failed to fetch marketplace invoices

  /crops/sync:
    post:
      summary: Sync Investments
      description: >-
        Sinkronisasi investasi dari blockchain ke database.
        Panggil setelah investor melakukan transaksi invest() di frontend.
      operationId: syncCrops
      tags:
        - Investor Crops
      security:
        - BearerAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CropSyncRequest'
      responses:
        '200':
          description: Sync berhasil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/CropSyncResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notAuthenticated:
                  summary: User not authenticated
                  value:
                    status: error
                    message: User not authenticated
                walletNotFound:
                  summary: Wallet address not found
                  value:
                    status: error
                    message: Wallet address not found
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  /crops:
    get:
      summary: List Crops
      description: Mendapatkan daftar semua crops milik user dengan pagination.
      operationId: listCrops
      tags:
        - Investor Crops
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: query
          required: false
          description: 'Filter status crop: growing, ready, harvested'
          schema:
            type: string
            enum:
              - growing
              - ready
              - harvested
        - name: page
          in: query
          required: false
          description: 'Page number (default: 1)'
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          required: false
          description: 'Items per page (default: 10, max: 100)'
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
        - name: sort_by
          in: query
          required: false
          description: Field untuk sorting
          schema:
            type: string
            enum:
              - invested_at
              - progress
              - status
            default: invested_at
        - name: sort_order
          in: query
          required: false
          description: Urutan sorting
          schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
      responses:
        '200':
          description: List crops berhasil diambil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/CropsListResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: User not authenticated
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  /crops/{id}:
    get:
      summary: Get Crop Detail
      description: Mendapatkan detail satu crop.
      operationId: getCropDetail
      tags:
        - Investor Crops
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Crop/Investment ID (UUID)
          schema:
            type: string
            format: uuid
            example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Crop detail berhasil diambil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/Crop'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: User not authenticated
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Crop not found
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  /crops/{id}/water:
    post:
      summary: Water Crop
      description: >-
        Menyiram tanaman (game mechanic untuk XP).
        Tidak mempengaruhi progress - hanya gimmick.
        Setiap water menggunakan 10 water points dan user mendapat 5 XP.
      operationId: waterCrop
      tags:
        - Investor Crops
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Crop/Investment ID (UUID)
          schema:
            type: string
            format: uuid
            example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Crop berhasil disiram
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/WaterCropResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Not enough water points
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: User not authenticated
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Crop not found
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  /crops/{id}/harvest/sync:
    post:
      summary: Sync Harvest
      description: >-
        Sinkronisasi status harvest dari blockchain setelah user melakukan harvest() di frontend.
      operationId: syncHarvest
      tags:
        - Investor Crops
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Crop/Investment ID (UUID)
          schema:
            type: string
            format: uuid
            example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Harvest sync berhasil
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/HarvestSyncResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Crop already harvested
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: User not authenticated
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Crop not found
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: error
                message: Internal server error

  # ==================== INVESTOR LEADERBOARD ====================
  /leaderboard:
    get:
      summary: Get Leaderboard
      description: >-
        Mendapatkan leaderboard investor berdasarkan XP, kekayaan (total investment), atau profit.
        Leaderboard di-cache selama 5 menit untuk performa.
        Posisi user saat ini selalu fresh (tidak di-cache).
      operationId: getLeaderboard
      tags:
        - Investor Leaderboard
      security:
        - BearerAuth: []
      parameters:
        - name: type
          in: query
          required: true
          description: Tipe leaderboard
          schema:
            type: string
            enum:
              - xp
              - wealth
              - profit
            example: xp
        - name: limit
          in: query
          required: false
          description: Jumlah user yang ditampilkan (max 100)
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
            example: 10
      responses:
        '200':
          description: Leaderboard berhasil diambil
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LeaderboardResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingType:
                  summary: Type tidak ada
                  value:
                    error: "Key: 'GetLeaderboardRequest.Type' Error:Field validation for 'Type' failed on the 'required' tag"
                invalidType:
                  summary: Type tidak valid
                  value:
                    error: "Key: 'GetLeaderboardRequest.Type' Error:Field validation for 'Type' failed on the 'oneof' tag"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: User not authenticated
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: Internal server error

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token dari login endpoint (investor)
    FarmerBearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token dari farmer login endpoint (farmer authentication terpisah)

  schemas:
    # ==================== USER AUTH SCHEMAS ====================
    NonceResponse:
      type: object
      properties:
        nonce:
          type: string
          description: Nonce yang dibuat untuk signing
          example: abc123xyz
        message:
          type: string
          description: Pesan yang harus di-sign oleh wallet
          example: 'Sign this message to login to OwnaFarm: abc123xyz'

    LoginRequest:
      type: object
      required:
        - wallet_address
        - signature
        - nonce
      properties:
        wallet_address:
          type: string
          pattern: ^0x[0-9a-fA-F]{40}$
          description: Alamat wallet Ethereum
          example: '0x742d35Cc6634C0532925a3b844BC9e7595f7CCCC'
        signature:
          type: string
          description: Signature EIP-712 dari wallet
          example: '0x...'
        nonce:
          type: string
          description: Nonce dari endpoint /auth/nonce
          example: abc123xyz

    LoginResponse:
      type: object
      properties:
        token:
          type: string
          description: JWT token untuk autentikasi
          example: eyJhbGciOiJIUzI1NiIs...
        user:
          $ref: '#/components/schemas/User'

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: UUID user
          example: 550e8400-e29b-41d4-a716-446655440000
        wallet_address:
          type: string
          description: Alamat wallet yang sudah dinormalisasi
          example: '0x742d35Cc6634C0532925a3b844BC9e7595f7CCCC'

    # ==================== FARMER AUTH SCHEMAS ====================
    FarmerNonceResponse:
      type: object
      properties:
        nonce:
          type: string
          description: Nonce untuk signing
          example: a1b2c3d4e5f67890...
        message:
          type: string
          description: Pesan yang harus di-sign oleh wallet farmer
          example: "Sign this message to login to OwnaFarm as Farmer.\n\nNonce: a1b2c3d4e5f67890..."

    FarmerLoginRequest:
      type: object
      required:
        - wallet_address
        - signature
        - nonce
      properties:
        wallet_address:
          type: string
          pattern: ^0x[0-9a-fA-F]{40}$
          description: Wallet address farmer
          example: '0x742d35Cc6634C0532925a3b844BC9e7595f7CCCC'
        signature:
          type: string
          description: Signature dari wallet
          example: '0x1234567890abcdef...'
        nonce:
          type: string
          description: Nonce dari endpoint /farmer/auth/nonce
          example: a1b2c3d4e5f67890...

    FarmerLoginResponse:
      type: object
      properties:
        token:
          type: string
          description: JWT token untuk autentikasi farmer
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        farmer:
          $ref: '#/components/schemas/FarmerLoginData'

    FarmerLoginData:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
        wallet_address:
          type: string
          example: '0x742d35cc6634c0532925a3b844bc9e7595f7cccc'
        full_name:
          type: string
          example: Budi Santoso
        email:
          type: string
          example: budi.santoso@example.com

    FarmerNotApprovedResponse:
      type: object
      properties:
        status:
          type: string
          example: error
        message:
          type: string
          example: Farmer account is not approved
        data:
          type: object
          properties:
            current_status:
              type: string
              enum: [pending, under_review, rejected, suspended]
              example: pending

    FarmerProfile:
      type: object
      properties:
        id:
          type: string
          format: uuid
        status:
          type: string
          enum: [pending, under_review, approved, rejected, suspended]
        wallet_address:
          type: string
        full_name:
          type: string
        email:
          type: string
        phone_number:
          type: string
        id_number:
          type: string
        date_of_birth:
          type: string
          format: date-time
        address:
          type: string
        province:
          type: string
        city:
          type: string
        district:
          type: string
        postal_code:
          type: string
        business_name:
          type: string
        business_type:
          type: string
          enum: [individual, cv, pt, ud, cooperative]
        npwp:
          type: string
        bank_name:
          type: string
        bank_account_number:
          type: string
        bank_account_name:
          type: string
        years_of_experience:
          type: integer
        crops_expertise:
          type: array
          items:
            type: string
        reviewed_by:
          type: string
        reviewed_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # ==================== ADMIN AUTH SCHEMAS ====================
    AdminNonceResponse:
      type: object
      properties:
        nonce:
          type: string
          description: Nonce untuk signing (one-time use, expired 5 menit)
          example: a1b2c3d4e5f6789012345678
        sign_message:
          type: string
          description: Pesan yang harus di-sign oleh wallet
          example: "Sign this message to login to OwnaFarm Admin.\n\nNonce: a1b2c3d4e5f6789012345678"

    AdminLoginRequest:
      type: object
      required:
        - wallet_address
        - signature
        - nonce
      properties:
        wallet_address:
          type: string
          pattern: ^0x[0-9a-fA-F]{40}$
          description: Wallet address admin (format 0x...)
          example: '0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb'
        signature:
          type: string
          description: Signature hasil sign sign_message
          example: '0x1234567890abcdef...'
        nonce:
          type: string
          description: Nonce dari endpoint nonce (one-time use)
          example: a1b2c3d4e5f6789012345678

    AdminLoginResponse:
      type: object
      properties:
        token:
          type: string
          description: JWT token untuk autentikasi
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        admin:
          $ref: '#/components/schemas/Admin'

    Admin:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: UUID admin
          example: 550e8400-e29b-41d4-a716-446655440000
        wallet_address:
          type: string
          description: Wallet address admin (lowercase)
          example: '0x742d35cc6634c0532925a3b844bc9e7595f0beb'
        role:
          type: string
          description: Role admin
          enum:
            - admin
          example: admin

    # ==================== ADMIN FARMER MANAGEMENT SCHEMAS ====================
    FarmersListResponse:
      type: object
      properties:
        farmers:
          type: array
          items:
            $ref: '#/components/schemas/FarmerListItem'
        pagination:
          $ref: '#/components/schemas/Pagination'

    FarmerListItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: UUID farmer
          example: f1a2b3c4-d5e6-7890-abcd-ef1234567890
        status:
          type: string
          description: Status farmer
          enum:
            - pending
            - under_review
            - approved
            - rejected
            - suspended
          example: pending
        wallet_address:
          type: string
          pattern: ^0x[0-9a-fA-F]{40}$
          description: Ethereum wallet address untuk login
          example: '0x742d35cc6634c0532925a3b844bc9e7595f7cccc'
        full_name:
          type: string
          description: Nama lengkap farmer
          example: Budi Santoso
        email:
          type: string
          format: email
          description: Email farmer
          example: budi@example.com
        phone_number:
          type: string
          description: Nomor telepon farmer
          example: '+628123456789'
        business_name:
          type: string
          description: Nama usaha
          example: Tani Makmur
        business_type:
          type: string
          description: Jenis usaha
          enum:
            - individual
            - cv
            - pt
            - ud
            - cooperative
          example: cv
        province:
          type: string
          description: Provinsi
          example: Jawa Barat
        city:
          type: string
          description: Kota/Kabupaten
          example: Bandung
        years_of_experience:
          type: integer
          description: Tahun pengalaman bertani
          example: 10
        created_at:
          type: string
          format: date-time
          description: Tanggal registrasi
          example: '2024-01-15T10:30:00Z'
        reviewed_at:
          type: string
          format: date-time
          nullable: true
          description: Tanggal review (null jika belum direview)
          example: null

    Pagination:
      type: object
      properties:
        page:
          type: integer
          description: Halaman saat ini
          example: 1
        limit:
          type: integer
          description: Jumlah item per halaman
          example: 10
        total_items:
          type: integer
          description: Total semua item
          example: 42
        total_pages:
          type: integer
          description: Total halaman
          example: 5

    FarmerDetailResponse:
      type: object
      description: Detail lengkap farmer untuk admin
      properties:
        id:
          type: string
          format: uuid
          example: f1a2b3c4-d5e6-7890-abcd-ef1234567890
        status:
          type: string
          enum: [pending, under_review, approved, rejected, suspended]
          example: pending
        wallet_address:
          type: string
          pattern: ^0x[0-9a-fA-F]{40}$
          description: Ethereum wallet address untuk login
          example: '0x742d35cc6634c0532925a3b844bc9e7595f7cccc'
        full_name:
          type: string
          example: Budi Santoso
        email:
          type: string
          format: email
          example: budi@example.com
        phone_number:
          type: string
          example: '+628123456789'
        id_number:
          type: string
          description: NIK
          example: '3201234567890123'
        date_of_birth:
          type: string
          format: date
          example: '1985-06-15'
        address:
          type: string
          example: Jl. Merdeka No. 123
        province:
          type: string
          example: Jawa Barat
        city:
          type: string
          example: Bandung
        district:
          type: string
          example: Coblong
        postal_code:
          type: string
          example: '40132'
        business_name:
          type: string
          nullable: true
          example: Tani Makmur
        business_type:
          type: string
          enum: [individual, cv, pt, ud, cooperative]
          example: cv
        npwp:
          type: string
          nullable: true
          example: '12.345.678.9-123.000'
        bank_name:
          type: string
          example: Bank BCA
        bank_account_number:
          type: string
          example: '1234567890'
        bank_account_name:
          type: string
          example: Budi Santoso
        years_of_experience:
          type: integer
          example: 10
        crops_expertise:
          type: array
          items:
            type: string
          example: [padi, jagung, cabai]
        documents:
          type: array
          description: List dokumen dengan presigned download URL
          items:
            $ref: '#/components/schemas/FarmerDocumentItem'
        reviewed_by:
          type: string
          format: uuid
          nullable: true
        reviewed_at:
          type: string
          format: date-time
          nullable: true
        rejection_reason:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
          example: '2024-01-15T10:30:00Z'

    FarmerDocumentItem:
      type: object
      description: Dokumen farmer dengan presigned download URL
      properties:
        id:
          type: string
          format: uuid
          example: doc-uuid-1
        document_type:
          type: string
          description: Tipe dokumen
          enum: [ktp_photo, selfie_with_ktp, npwp_photo, bank_statement, land_certificate, business_license]
          example: ktp_photo
        file_name:
          type: string
          nullable: true
          example: ktp.jpg
        download_url:
          type: string
          format: uri
          description: Presigned URL untuk download (expired dalam 1 jam)
          example: https://storage.example.com/presigned-url...
        expires_in:
          type: integer
          description: Waktu expired dalam detik
          example: 3600

    FarmerApproveResponse:
      type: object
      properties:
        farmer_id:
          type: string
          format: uuid
          description: UUID farmer yang di-approve
          example: 550e8400-e29b-41d4-a716-446655440000
        status:
          type: string
          description: Status farmer setelah di-approve
          enum:
            - approved
          example: approved
        reviewed_by:
          type: string
          format: uuid
          description: UUID admin yang melakukan approve
          example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
        reviewed_at:
          type: string
          format: date-time
          description: Waktu approve
          example: '2024-01-15T14:30:00Z'

    FarmerRejectRequest:
      type: object
      properties:
        reason:
          type: string
          maxLength: 500
          description: Alasan penolakan (max 500 karakter)
          example: Dokumen tidak lengkap, mohon upload ulang KTP yang jelas.

    FarmerRejectResponse:
      type: object
      properties:
        farmer_id:
          type: string
          format: uuid
          description: UUID farmer yang di-reject
          example: 550e8400-e29b-41d4-a716-446655440000
        status:
          type: string
          description: Status farmer setelah di-reject
          enum:
            - rejected
          example: rejected
        reviewed_by:
          type: string
          format: uuid
          description: UUID admin yang melakukan reject
          example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
        reviewed_at:
          type: string
          format: date-time
          description: Waktu reject
          example: '2024-01-15T14:30:00Z'
        reason:
          type: string
          description: Alasan penolakan
          example: Dokumen tidak lengkap

    # ==================== FARMER REGISTRATION SCHEMAS ====================
    PresignRequest:
      type: object
      required:
        - document_types
      properties:
        document_types:
          type: array
          description: List jenis dokumen yang akan diupload
          items:
            type: string
            enum:
              - ktp_photo
              - selfie_with_ktp
              - npwp_photo
              - bank_statement
              - land_certificate
              - business_license
              - invoice_file
          example:
            - ktp_photo
            - selfie_with_ktp

    PresignResponse:
      type: object
      properties:
        urls:
          type: array
          items:
            $ref: '#/components/schemas/PresignUrl'

    PresignUrl:
      type: object
      properties:
        document_type:
          type: string
          description: Jenis dokumen
          example: ktp_photo
        upload_url:
          type: string
          format: uri
          description: Presigned URL untuk upload (PUT request)
          example: 'https://s3.amazonaws.com/bucket/path?signature=...'
        file_key:
          type: string
          description: File key untuk digunakan saat registrasi
          example: farmers/documents/uuid-ktp.jpg

    FarmerRegistrationRequest:
      type: object
      required:
        - personal_info
        - business_info
        - documents
      properties:
        personal_info:
          $ref: '#/components/schemas/PersonalInfo'
        business_info:
          $ref: '#/components/schemas/BusinessInfo'
        documents:
          type: array
          description: List dokumen yang sudah diupload (min 1)
          minItems: 1
          items:
            $ref: '#/components/schemas/DocumentInfo'

    PersonalInfo:
      type: object
      required:
        - full_name
        - email
        - phone_number
        - id_number
        - date_of_birth
        - address
        - province
        - city
        - district
        - postal_code
        - wallet_address
      properties:
        full_name:
          type: string
          maxLength: 100
          description: Nama lengkap sesuai KTP
          example: Budi Santoso
        email:
          type: string
          format: email
          maxLength: 255
          description: Email yang valid
          example: budi.santoso@example.com
        phone_number:
          type: string
          maxLength: 20
          description: Nomor telepon aktif
          example: '+628123456789'
        id_number:
          type: string
          maxLength: 20
          description: Nomor KTP/NIK
          example: '3201234567890123'
        date_of_birth:
          type: string
          format: date
          description: Tanggal lahir (format YYYY-MM-DD)
          example: '1985-06-15'
        address:
          type: string
          description: Alamat lengkap
          example: Jl. Merdeka No. 123
        province:
          type: string
          maxLength: 100
          description: Provinsi
          example: Jawa Barat
        city:
          type: string
          maxLength: 100
          description: Kota/Kabupaten
          example: Bandung
        district:
          type: string
          maxLength: 100
          description: Kecamatan
          example: Coblong
        postal_code:
          type: string
          maxLength: 10
          description: Kode pos
          example: '40132'
        wallet_address:
          type: string
          pattern: ^0x[0-9a-fA-F]{40}$
          minLength: 42
          maxLength: 42
          description: Ethereum wallet address untuk login via signature
          example: '0x742d35Cc6634C0532925a3b844BC9e7595f7CCCC'

    BusinessInfo:
      type: object
      required:
        - business_type
        - bank_name
        - bank_account_number
        - bank_account_name
      properties:
        business_name:
          type: string
          maxLength: 200
          description: Nama usaha (optional)
          example: Tani Makmur
        business_type:
          type: string
          description: Jenis usaha
          enum:
            - individual
            - cv
            - pt
            - ud
            - cooperative
          example: cv
        npwp:
          type: string
          maxLength: 30
          description: Nomor NPWP (optional)
          example: 12.345.678.9-123.000
        bank_name:
          type: string
          maxLength: 100
          description: Nama bank
          example: Bank BCA
        bank_account_number:
          type: string
          maxLength: 30
          description: Nomor rekening
          example: '1234567890'
        bank_account_name:
          type: string
          maxLength: 100
          description: Nama pemilik rekening
          example: Budi Santoso
        years_of_experience:
          type: integer
          description: Tahun pengalaman bertani
          example: 10
        crops_expertise:
          type: array
          description: List komoditas yang dikuasai
          items:
            type: string
          example:
            - padi
            - jagung
            - cabai

    DocumentInfo:
      type: object
      required:
        - document_type
        - file_key
      properties:
        document_type:
          type: string
          description: Jenis dokumen
          enum:
            - ktp_photo
            - selfie_with_ktp
            - npwp_photo
            - bank_statement
            - land_certificate
            - business_license
            - invoice_file
          example: ktp_photo
        file_key:
          type: string
          description: File key dari presigned URL response
          example: farmers/documents/uuid-ktp.jpg
        file_name:
          type: string
          description: Nama file original (optional)
          example: ktp-budi.jpg
        file_size:
          type: integer
          description: Ukuran file dalam bytes (optional)
          example: 245678
        mime_type:
          type: string
          description: MIME type file (optional)
          example: image/jpeg

    FarmerRegistrationResponse:
      type: object
      properties:
        farmer_id:
          type: string
          format: uuid
          description: UUID farmer yang baru dibuat
          example: f1a2b3c4-d5e6-7890-abcd-ef1234567890
        status:
          type: string
          description: Status farmer (default pending)
          enum:
            - pending
            - under_review
            - approved
            - rejected
            - suspended
          example: pending

    # ==================== FARM SCHEMAS ====================
    CreateFarmRequest:
      type: object
      required:
        - name
        - location
      properties:
        name:
          type: string
          maxLength: 200
          description: Nama kebun
          example: Kebun Cabai Ciwidey
        description:
          type: string
          description: Deskripsi kebun
          example: Kebun cabai rawit merah seluas 2 hektar di dataran tinggi Ciwidey
        location:
          type: string
          maxLength: 255
          description: Alamat/lokasi kebun
          example: Ciwidey, Bandung, Jawa Barat
        latitude:
          type: number
          format: float
          minimum: -90
          maximum: 90
          description: Koordinat latitude
          example: -7.1234567
        longitude:
          type: number
          format: float
          minimum: -180
          maximum: 180
          description: Koordinat longitude
          example: 107.4567890
        land_area:
          type: number
          format: float
          minimum: 0
          description: Luas lahan dalam hektar
          example: 2.5

    UpdateFarmRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 200
          description: Nama kebun
          example: Kebun Cabai Ciwidey Updated
        description:
          type: string
          description: Deskripsi baru
          example: Deskripsi baru
        location:
          type: string
          maxLength: 255
          description: Lokasi baru
          example: Lokasi baru
        latitude:
          type: number
          format: float
          minimum: -90
          maximum: 90
          description: Koordinat latitude
          example: -7.1234567
        longitude:
          type: number
          format: float
          minimum: -180
          maximum: 180
          description: Koordinat longitude
          example: 107.4567890
        land_area:
          type: number
          format: float
          minimum: 0
          description: Luas lahan dalam hektar
          example: 3.0
        cctv_url:
          type: string
          format: uri
          description: URL CCTV stream
          example: rtsp://camera.example.com/stream
        cctv_image_url:
          type: string
          format: uri
          description: URL snapshot CCTV
          example: https://storage.example.com/cctv/snapshot.jpg

    Farm:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: UUID farm
          example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
        farmer_id:
          type: string
          format: uuid
          description: UUID farmer pemilik
          example: f1a2b3c4-d5e6-7890-abcd-ef1234567890
        name:
          type: string
          description: Nama kebun
          example: Kebun Cabai Ciwidey
        description:
          type: string
          nullable: true
          description: Deskripsi kebun
          example: Kebun cabai rawit merah seluas 2 hektar di dataran tinggi Ciwidey
        location:
          type: string
          description: Alamat/lokasi kebun
          example: Ciwidey, Bandung, Jawa Barat
        latitude:
          type: number
          format: float
          nullable: true
          description: Koordinat latitude
          example: -7.1234567
        longitude:
          type: number
          format: float
          nullable: true
          description: Koordinat longitude
          example: 107.4567890
        land_area:
          type: number
          format: float
          nullable: true
          description: Luas lahan dalam hektar
          example: 2.5
        cctv_url:
          type: string
          format: uri
          nullable: true
          description: URL CCTV stream
          example: rtsp://camera.example.com/stream
        cctv_image_url:
          type: string
          format: uri
          nullable: true
          description: URL snapshot CCTV
          example: https://storage.example.com/cctv/snapshot.jpg
        cctv_last_updated:
          type: string
          format: date-time
          nullable: true
          description: Waktu terakhir update CCTV
          example: '2024-01-15T14:00:00Z'
        is_active:
          type: boolean
          description: Status aktif kebun
          example: true
        created_at:
          type: string
          format: date-time
          description: Waktu dibuat
          example: '2024-01-15T10:30:00Z'
        updated_at:
          type: string
          format: date-time
          description: Waktu update terakhir
          example: '2024-01-15T10:30:00Z'

    FarmListItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: UUID farm
          example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
        name:
          type: string
          description: Nama kebun
          example: Kebun Cabai Ciwidey
        location:
          type: string
          description: Lokasi kebun
          example: Ciwidey, Bandung, Jawa Barat
        land_area:
          type: number
          format: float
          nullable: true
          description: Luas lahan dalam hektar
          example: 2.5
        is_active:
          type: boolean
          description: Status aktif
          example: true
        created_at:
          type: string
          format: date-time
          description: Waktu dibuat
          example: '2024-01-15T10:30:00Z'

    FarmsListResponse:
      type: object
      properties:
        farms:
          type: array
          items:
            $ref: '#/components/schemas/FarmListItem'
        pagination:
          $ref: '#/components/schemas/Pagination'

    # ==================== INVOICE SCHEMAS ====================
    InvoiceImagePresignRequest:
      type: object
      required:
        - file_name
        - content_type
      properties:
        file_name:
          type: string
          description: Nama file gambar
          example: cabai-rawit.jpg
        content_type:
          type: string
          description: MIME type gambar
          enum:
            - image/jpeg
            - image/png
            - image/webp
          example: image/jpeg

    InvoiceImagePresignResponse:
      type: object
      properties:
        upload_url:
          type: string
          format: uri
          description: Presigned URL untuk upload
          example: https://s3.amazonaws.com/bucket/invoices/images/uuid-cabai.jpg?signature=...
        file_key:
          type: string
          description: File key untuk digunakan saat create invoice
          example: invoices/images/uuid-cabai-rawit.jpg

    CreateInvoiceRequest:
      type: object
      required:
        - farm_id
        - name
        - target_fund
        - yield_percent
        - duration_days
      properties:
        farm_id:
          type: string
          format: uuid
          description: ID kebun yang akan digunakan
          example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
        name:
          type: string
          maxLength: 200
          description: 'Nama proyek/tanaman (misal: "Cabai Indofood")'
          example: Cabai Rawit Merah - Batch 1
        description:
          type: string
          description: Deskripsi proyek
          example: Proyek penanaman cabai rawit merah untuk kebutuhan Indofood. Target panen 3 bulan.
        image_key:
          type: string
          description: File key dari presigned upload (gambar tanaman untuk game)
          example: invoices/images/uuid-cabai-rawit.jpg
        target_fund:
          type: number
          format: float
          minimum: 0
          exclusiveMinimum: true
          description: Target pendanaan dalam GOLD
          example: 50000000
        yield_percent:
          type: number
          format: float
          minimum: 0
          exclusiveMinimum: true
          maximum: 100
          description: 'Persentase return (misal: 18.5%)'
          example: 18.5
        duration_days:
          type: integer
          minimum: 1
          description: Durasi sampai panen/maturity dalam hari
          example: 90
        offtaker_id:
          type: string
          maxLength: 100
          description: ID offtaker/pembeli (optional)
          example: indofood-001
        token_id:
          type: integer
          format: int64
          nullable: true
          description: Token ID dari smart contract event InvoiceSubmitted
          example: 12345
        tx_hash:
          type: string
          nullable: true
          description: Transaction hash dari transaksi submitInvoice
          example: '0xabc123def456789012345678901234567890123456789012345678901234abcd'

    Invoice:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: UUID invoice
          example: i1a2b3c4-d5e6-7890-abcd-ef1234567890
        farm_id:
          type: string
          format: uuid
          description: UUID farm
          example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
        farm_name:
          type: string
          description: Nama kebun
          example: Kebun Cabai Ciwidey
        token_id:
          type: integer
          nullable: true
          description: Token ID on-chain (null jika belum approved)
          example: 12345
        offtaker_id:
          type: string
          nullable: true
          description: ID offtaker/pembeli
          example: indofood-001
        name:
          type: string
          description: Nama proyek
          example: Cabai Rawit Merah - Batch 1
        description:
          type: string
          nullable: true
          description: Deskripsi proyek
          example: Proyek penanaman cabai rawit merah untuk kebutuhan Indofood.
        image_url:
          type: string
          nullable: true
          description: URL gambar invoice
          example: invoices/images/uuid-cabai-rawit.jpg
        target_fund:
          type: number
          format: float
          description: Target pendanaan dalam GOLD
          example: 50000000
        yield_percent:
          type: number
          format: float
          description: Persentase return
          example: 18.5
        duration_days:
          type: integer
          description: Durasi sampai panen/maturity dalam hari
          example: 90
        total_funded:
          type: number
          format: float
          description: Total dana yang sudah terkumpul
          example: 25000000
        is_fully_funded:
          type: boolean
          description: Apakah sudah fully funded
          example: false
        status:
          type: string
          description: Status invoice
          enum:
            - pending
            - approved
            - rejected
          example: pending
        rejection_reason:
          type: string
          nullable: true
          description: Alasan penolakan (jika rejected)
          example: null
        reviewed_by:
          type: string
          format: uuid
          nullable: true
          description: UUID admin yang review
          example: null
        reviewed_at:
          type: string
          format: date-time
          nullable: true
          description: Waktu review
          example: null
        approved_at:
          type: string
          format: date-time
          nullable: true
          description: Waktu approve
          example: null
        funding_deadline:
          type: string
          format: date-time
          nullable: true
          description: Deadline pendanaan
          example: null
        maturity_date:
          type: string
          format: date-time
          nullable: true
          description: Tanggal jatuh tempo
          example: null
        approval_tx_hash:
          type: string
          nullable: true
          description: Transaction hash on-chain approval
          example: null
        created_at:
          type: string
          format: date-time
          description: Waktu dibuat
          example: '2024-01-15T10:30:00Z'
        updated_at:
          type: string
          format: date-time
          description: Waktu update terakhir
          example: '2024-01-15T10:30:00Z'

    InvoiceListItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: UUID invoice
          example: i1a2b3c4-d5e6-7890-abcd-ef1234567890
        farm_id:
          type: string
          format: uuid
          description: UUID farm
          example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
        farm_name:
          type: string
          description: Nama kebun
          example: Kebun Cabai Ciwidey
        name:
          type: string
          description: Nama proyek
          example: Cabai Rawit Merah - Batch 1
        image_url:
          type: string
          nullable: true
          description: URL gambar invoice
          example: invoices/images/uuid-cabai-rawit.jpg
        target_fund:
          type: number
          format: float
          description: Target pendanaan
          example: 50000000
        yield_percent:
          type: number
          format: float
          description: Persentase return
          example: 18.5
        duration_days:
          type: integer
          description: Durasi dalam hari
          example: 90
        total_funded:
          type: number
          format: float
          description: Total dana terkumpul
          example: 0
        is_fully_funded:
          type: boolean
          description: Status fully funded
          example: false
        status:
          type: string
          description: Status invoice
          enum:
            - pending
            - approved
            - rejected
          example: pending
        created_at:
          type: string
          format: date-time
          description: Waktu dibuat
          example: '2024-01-15T10:30:00Z'

    FarmerInvoicesListResponse:
      type: object
      properties:
        invoices:
          type: array
          items:
            $ref: '#/components/schemas/InvoiceListItem'
        pagination:
          $ref: '#/components/schemas/Pagination'

    AdminInvoiceListItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: UUID invoice
          example: i1a2b3c4-d5e6-7890-abcd-ef1234567890
        farm_id:
          type: string
          format: uuid
          description: UUID farm
          example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
        farm_name:
          type: string
          description: Nama kebun
          example: Kebun Cabai Ciwidey
        farmer_id:
          type: string
          format: uuid
          description: UUID farmer
          example: f1a2b3c4-d5e6-7890-abcd-ef1234567890
        farmer_name:
          type: string
          description: Nama farmer
          example: Budi Santoso
        name:
          type: string
          description: Nama proyek
          example: Cabai Rawit Merah - Batch 1
        image_url:
          type: string
          nullable: true
          description: URL gambar invoice
          example: invoices/images/uuid-cabai-rawit.jpg
        target_fund:
          type: number
          format: float
          description: Target pendanaan
          example: 50000000
        yield_percent:
          type: number
          format: float
          description: Persentase return
          example: 18.5
        duration_days:
          type: integer
          description: Durasi dalam hari
          example: 90
        total_funded:
          type: number
          format: float
          description: Total dana terkumpul
          example: 0
        is_fully_funded:
          type: boolean
          description: Status fully funded
          example: false
        status:
          type: string
          description: Status invoice
          enum:
            - pending
            - approved
            - rejected
          example: pending
        created_at:
          type: string
          format: date-time
          description: Waktu dibuat
          example: '2024-01-15T10:30:00Z'
        reviewed_at:
          type: string
          format: date-time
          nullable: true
          description: Waktu review
          example: null

    AdminInvoicesListResponse:
      type: object
      properties:
        invoices:
          type: array
          items:
            $ref: '#/components/schemas/AdminInvoiceListItem'
        pagination:
          $ref: '#/components/schemas/Pagination'

    AdminInvoiceDetail:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: UUID invoice
          example: i1a2b3c4-d5e6-7890-abcd-ef1234567890
        farm_id:
          type: string
          format: uuid
          description: UUID farm
          example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
        farm_name:
          type: string
          description: Nama kebun
          example: Kebun Cabai Ciwidey
        token_id:
          type: integer
          nullable: true
          description: Token ID on-chain
          example: null
        offtaker_id:
          type: string
          nullable: true
          description: ID offtaker
          example: indofood-001
        name:
          type: string
          description: Nama proyek
          example: Cabai Rawit Merah - Batch 1
        description:
          type: string
          nullable: true
          description: Deskripsi proyek
          example: Proyek penanaman cabai rawit merah untuk kebutuhan Indofood.
        image_url:
          type: string
          nullable: true
          description: URL gambar invoice
          example: invoices/images/uuid-cabai-rawit.jpg
        target_fund:
          type: number
          format: float
          description: Target pendanaan
          example: 50000000
        yield_percent:
          type: number
          format: float
          description: Persentase return
          example: 18.5
        duration_days:
          type: integer
          description: Durasi dalam hari
          example: 90
        total_funded:
          type: number
          format: float
          description: Total dana terkumpul
          example: 0
        is_fully_funded:
          type: boolean
          description: Status fully funded
          example: false
        status:
          type: string
          description: Status invoice
          enum:
            - pending
            - approved
            - rejected
          example: pending
        rejection_reason:
          type: string
          nullable: true
          description: Alasan penolakan
          example: null
        reviewed_by:
          type: string
          format: uuid
          nullable: true
          description: UUID admin reviewer
          example: null
        reviewed_at:
          type: string
          format: date-time
          nullable: true
          description: Waktu review
          example: null
        approved_at:
          type: string
          format: date-time
          nullable: true
          description: Waktu approve
          example: null
        funding_deadline:
          type: string
          format: date-time
          nullable: true
          description: Deadline pendanaan
          example: null
        maturity_date:
          type: string
          format: date-time
          nullable: true
          description: Tanggal jatuh tempo
          example: null
        approval_tx_hash:
          type: string
          nullable: true
          description: Transaction hash on-chain
          example: null
        created_at:
          type: string
          format: date-time
          description: Waktu dibuat
          example: '2024-01-15T10:30:00Z'
        updated_at:
          type: string
          format: date-time
          description: Waktu update terakhir
          example: '2024-01-15T10:30:00Z'

    InvoiceApproveRequest:
      type: object
      description: Request body untuk approve invoice dengan data blockchain
      required:
        - token_id
        - approval_tx_hash
      properties:
        token_id:
          type: integer
          format: int64
          description: Token ID yang didapat dari smart contract setelah approve
          example: 123
        approval_tx_hash:
          type: string
          minLength: 66
          maxLength: 66
          description: Transaction hash dari transaksi approve di blockchain (66 karakter)
          example: "0xabc123def456789012345678901234567890123456789012345678901234abcd"

    InvoiceApproveResponse:
      type: object
      properties:
        invoice_id:
          type: string
          format: uuid
          description: UUID invoice yang di-approve
          example: i1a2b3c4-d5e6-7890-abcd-ef1234567890
        status:
          type: string
          description: Status invoice setelah di-approve
          enum:
            - approved
          example: approved
        token_id:
          type: integer
          format: int64
          description: Token ID di blockchain
          example: 123
        approval_tx_hash:
          type: string
          description: Transaction hash dari transaksi approve
          example: "0xabc123def456789012345678901234567890123456789012345678901234abcd"
        reviewed_by:
          type: string
          format: uuid
          description: UUID admin yang melakukan approve
          example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
        reviewed_at:
          type: string
          format: date-time
          description: Waktu approve
          example: '2024-01-16T09:00:00Z'

    InvoiceRejectRequest:
      type: object
      properties:
        reason:
          type: string
          description: Alasan penolakan
          example: Target pendanaan tidak realistis untuk luas lahan yang tersedia.

    InvoiceRejectResponse:
      type: object
      properties:
        invoice_id:
          type: string
          format: uuid
          description: UUID invoice yang di-reject
          example: i1a2b3c4-d5e6-7890-abcd-ef1234567890
        status:
          type: string
          description: Status invoice setelah di-reject
          enum:
            - rejected
          example: rejected
        reviewed_by:
          type: string
          format: uuid
          description: UUID admin yang melakukan reject
          example: a1b2c3d4-e5f6-7890-abcd-ef1234567890
        reviewed_at:
          type: string
          format: date-time
          description: Waktu reject
          example: '2024-01-16T09:00:00Z'
        reason:
          type: string
          description: Alasan penolakan
          example: Target pendanaan tidak realistis

    # ==================== INVESTOR CROPS SCHEMAS ====================
    MarketplaceInvoicesListResponse:
      type: object
      properties:
        invoices:
          type: array
          items:
            $ref: '#/components/schemas/MarketplaceInvoiceItem'
        pagination:
          $ref: '#/components/schemas/Pagination'

    MarketplaceInvoiceItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Invoice ID
          example: 550e8400-e29b-41d4-a716-446655440000
        token_id:
          type: integer
          format: int64
          nullable: true
          description: Token ID on-chain (untuk investasi melalui smart contract)
          example: 12345
        name:
          type: string
          description: Invoice/crop name
          example: Padi Organik Premium
        description:
          type: string
          nullable: true
          description: Invoice description
          example: Penanaman padi organik berkualitas tinggi dengan sistem irigasi modern
        image_url:
          type: string
          nullable: true
          description: Invoice/crop image URL
          example: https://storage.example.com/invoices/rice-organic.jpg
        target_fund:
          type: string
          description: Target funding amount in GOLD (decimal string)
          example: '5000.00000000'
        total_funded:
          type: string
          description: Total funded amount in GOLD (decimal string)
          example: '1250.00000000'
        funding_progress:
          type: number
          format: float
          description: Funding progress percentage (calculated)
          example: 25.0
        yield_percent:
          type: string
          description: Expected yield percentage (decimal string)
          example: '18.50'
        duration_days:
          type: integer
          description: Investment duration in days
          example: 120
        maturity_date:
          type: string
          format: date-time
          nullable: true
          description: Maturity/harvest date
          example: '2026-05-14T00:00:00Z'
        farm_id:
          type: string
          format: uuid
          description: Farm ID
          example: f1a2b3c4-d5e6-7890-abcd-ef1234567890
        farm_name:
          type: string
          description: Farm name
          example: Kebun Makmur Sejahtera
        farm_location:
          type: string
          description: Farm location
          example: Bogor, Jawa Barat
        farm_land_area:
          type: string
          nullable: true
          description: Farm land area in hectares (decimal string)
          example: '2.50000000'
        farm_cctv_image:
          type: string
          nullable: true
          description: Farm CCTV snapshot URL
          example: https://storage.example.com/farms/cctv-snapshot.jpg
        farmer_name:
          type: string
          description: Farmer full name
          example: Budi Santoso
        created_at:
          type: string
          format: date-time
          description: Invoice creation date
          example: '2026-01-10T08:00:00Z'
        approved_at:
          type: string
          format: date-time
          nullable: true
          description: Invoice approval date
          example: '2026-01-12T10:30:00Z'

    CropSyncRequest:
      type: object
      properties:
        tx_hash:
          type: string
          description: Transaction hash untuk tracking (optional)
          example: '0x123abc...'

    CropSyncResponse:
      type: object
      properties:
        synced_count:
          type: integer
          description: Jumlah crops yang berhasil disinkronkan
          example: 2
        new_crops:
          type: array
          items:
            $ref: '#/components/schemas/Crop'

    Crop:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: UUID crop/investment
          example: 550e8400-e29b-41d4-a716-446655440000
        name:
          type: string
          description: Nama tanaman/proyek
          example: Cabai Indofood
        image:
          type: string
          format: uri
          description: URL gambar crop untuk game
          example: https://storage.ownafarm.com/crops/cabai.png
        cctv_image:
          type: string
          format: uri
          nullable: true
          description: URL gambar CCTV farm
          example: https://storage.ownafarm.com/cctv/farm1.jpg
        location:
          type: string
          description: Lokasi farm
          example: Malang, Jawa Timur
        progress:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Progress pertumbuhan dalam persen
          example: 75
        days_left:
          type: integer
          minimum: 0
          description: Jumlah hari tersisa sampai maturity
          example: 15
        yield_percent:
          type: number
          format: float
          description: Persentase return
          example: 18.5
        invested:
          type: number
          format: float
          description: Jumlah investasi dalam GOLD
          example: 1000.0
        status:
          type: string
          description: Status crop
          enum:
            - growing
            - ready
            - harvested
          example: growing
        planted_at:
          type: string
          format: date-time
          description: Waktu investasi/penanaman
          example: '2026-01-10T10:00:00Z'
        water_count:
          type: integer
          minimum: 0
          description: Jumlah siram yang sudah dilakukan
          example: 5
        can_harvest:
          type: boolean
          description: Apakah crop sudah bisa dipanen
          example: false
        harvest_amount:
          type: number
          format: float
          nullable: true
          description: Jumlah hasil panen (muncul setelah harvested)
          example: null

    CropsListResponse:
      type: object
      properties:
        crops:
          type: array
          items:
            $ref: '#/components/schemas/Crop'
        total_count:
          type: integer
          description: Total jumlah crops
          example: 10
        page:
          type: integer
          description: Halaman saat ini
          example: 1
        limit:
          type: integer
          description: Items per page
          example: 10

    WaterCropResponse:
      type: object
      properties:
        crop:
          $ref: '#/components/schemas/Crop'
        xp_gained:
          type: integer
          description: XP yang didapat dari watering
          example: 5
        water_remaining:
          type: integer
          description: Sisa water points
          example: 90

    HarvestSyncResponse:
      type: object
      properties:
        crop:
          $ref: '#/components/schemas/Crop'
        xp_gained:
          type: integer
          description: XP yang didapat dari harvest (50 XP per harvest). 0 jika sudah pernah harvested.
          example: 50

    # ==================== LEADERBOARD SCHEMAS ====================
    LeaderboardEntry:
      type: object
      properties:
        rank:
          type: integer
          description: Posisi di leaderboard (1-indexed)
          example: 1
        wallet_address:
          type: string
          description: Wallet address user
          example: "0x742d35Cc6634C0532925a3b844BC9e7595f7CCCC"
        score:
          type: number
          format: float
          description: Score berdasarkan tipe leaderboard (XP/Wealth/Profit)
          example: 2500
        is_current_user:
          type: boolean
          description: Apakah entry ini adalah user saat ini
          example: false

    LeaderboardResponse:
      type: object
      properties:
        type:
          type: string
          description: Tipe leaderboard
          enum:
            - xp
            - wealth
            - profit
          example: xp
        entries:
          type: array
          description: Top-N users di leaderboard
          items:
            $ref: '#/components/schemas/LeaderboardEntry'
        user_entry:
          description: Posisi user saat ini jika tidak masuk top-N (null jika sudah di dalam entries)
          oneOf:
            - $ref: '#/components/schemas/LeaderboardEntry'
            - type: 'null'
          example: null

    # ==================== ERROR SCHEMAS ====================
    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          example: error
        message:
          type: string
          example: Error message here

    ErrorResponseWithAttempts:
      type: object
      properties:
        status:
          type: string
          example: error
        message:
          type: string
          example: Invalid signature
        remaining_attempts:
          type: integer
          description: Jumlah percobaan login tersisa
          example: 4

    RateLimitErrorResponse:
      type: object
      properties:
        status:
          type: string
          example: error
        message:
          type: string
          example: Too many login attempts
        retry_after_seconds:
          type: integer
          description: Waktu tunggu dalam detik sebelum bisa mencoba lagi
          example: 900